<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="mypage">

<!-- 사용자 정보가져오기 -->
<select id="userInfo" parameterType="memberVO" resultType="memberVO">
	select u_id, u_name, u_email, NVL(u_point,0) u_point, TO_CHAR(u_signup_date, 'YYYY.MM.DD') as u_signup_date, u_addr, u_tel, u_lvl from mom_user where u_id=#{u_id}
</select>

<!-- 사용자 게시글 -->
<select id="getboard" parameterType="memberVO" resultType="boardVO">
<![CDATA[	
SELECT rownum, b_no, b_title, b_date 
FROM (SELECT n.b_no as b_no, DECODE(SIGN(LENGTH(b_title)-5),1,SUBSTR(b_title,1,5)||'...',b_title)  as b_title, to_char(n.b_date,'YYYY-MM-DD') as b_date 
		FROM normal_board n WHERE n.u_id = #{u_id} ORDER BY n.b_date DESC) 
WHERE rownum <=4
]]>
</select>

<!-- 사용자 리플 -->
<select id="getReply" parameterType="memberVO" resultType="replyVO">
<![CDATA[
SELECT rownum, b_no, re_no, re_content, re_date 
FROM 
(SELECT n.b_no b_no, n.re_no as re_no, DECODE(SIGN(LENGTH(re_content)-5),1,SUBSTR(re_content,1,5)||'...',re_content)  as re_content, to_char(n.re_date,'YYYY-MM-DD') as re_date 
		FROM reply n WHERE n.re_id =#{u_id} ORDER BY n.re_date DESC) 
WHERE rownum <=4
]]>
</select>

<!-- 사용자 게시글 리스트 -->
<select id="getMyBoardList" parameterType="memberVO" resultType="boardVO">
select b_no, b_cate, b_title, b_nick, to_char(b_date,'YYYY-MM-DD') as b_date, NVL(b_good,0) b_good, NVL(b_count,0) b_count from normal_board where u_id=#{u_id}
</select>

<!-- 사용자 리플 리스트 -->
<select id="getReplyList" parameterType="memberVO" resultType="replyVO">
select b_no,  re_no,  DECODE(SIGN(LENGTH(re_content)-15),1,SUBSTR(re_content,1,15)||'...',re_content)  as re_content, re_nick, to_char(re_date,'YYYY-MM-DD') as re_date
from reply where re_id=#{u_id}
</select>

<!-- 사용자 qna리스트 4개 -->
<select id="getMyQna" parameterType="memberVO" resultType="qnaVO">
<![CDATA[
SELECT rownum, b_no, in_title, in_date 
FROM 
(SELECT n.b_no b_no, DECODE(SIGN(LENGTH(in_title)-5),1,SUBSTR(in_title,1,5)||'...',in_title)  as in_title, to_char(n.in_date,'YYYY-MM-DD') as in_date 
		FROM qna_board n WHERE n.u_id =#{u_id} ORDER BY n.in_date DESC) 
WHERE rownum <=4
]]>
</select>

<!-- my qna list -->
<select id="getMyQnaList" parameterType="memberVO" resultType="qnaVO">
select b_no, in_title, in_nick, in_count, TO_CHAR(in_date, 'YYYY.MM.DD') as in_date ,NVL(in_good,0) in_good
from qna_board where u_id=#{u_id} ORDER BY b_no desc
</select>

</mapper>