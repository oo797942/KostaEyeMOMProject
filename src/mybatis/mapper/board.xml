<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="board">

<!-- 육아꿀팁, 식단, 자랑 -->
<select id="allBoard" parameterType="string" resultType="boardVO"> 
	SELECT b_no, b_title, b_nick, b_count, TO_CHAR(b_date, 'YYYY.MM.DD') as b_date 
	FROM normal_board where b_cate=#{title} order by b_no desc
</select>
<!-- 질병 -->
<select id="allSick" parameterType="string" resultType="boardVO"> 
	select * from kid_sick
</select>
<!-- q&a -->
<select id="allQna" parameterType="string" resultType="boardVO"> 
	select * from qna_board
</select>

<!-- 조회수 카운트 -->
<update id="boardCount" parameterType="memberVO">
	UPDATE  normal_board SET b_count=NVL(b_count,0)+ 1 WHERE b_no =#{b_no}
</update>

<!-- 게시판 내용 -->
<select id="boardView" parameterType="boardVO" resultType="boardVO"> 
	select b_no, b_cate, b_title, b_content, b_ip, NVL(b_good,0) as b_good, b_count, b_nick, TO_CHAR(b_date, 'YYYY.MM.DD HH24:MI:SS') as b_date, b_photo1name, b_photo2name, b_photo3name
	from normal_board 
	where b_no=#{b_no}
</select>

<!-- 리플내용 -->
<select id="callreply" parameterType="boardVO" resultType="replyVO"> 
	
	
	select ip_1||'.'||ip_2||'.*.*' re_ip, re_content, TO_CHAR(re_date, 'YYYY.MM.DD HH24:MI:SS') as RE_DATE, RE_ID, RE_NICK, re_no
from      
(SELECT SUBSTR (IP, 1, INSTR (IP, '.', 1, 1) - 1) IP_1,
       SUBSTR (IP,
               INSTR (IP, '.', 1, 1) + 1,
               INSTR (IP, '.', 1, 2) - INSTR (IP, '.', 1, 1) - 1
              ) IP_2,
       SUBSTR (IP,
               INSTR (IP, '.', 1, 2) + 1,
               INSTR (IP, '.', 1, 3) - INSTR (IP, '.', 1, 2) - 1
              ) IP_3,
       SUBSTR (IP, INSTR (IP, '.', 1, 3) + 1) IP_4, RE_CONTENT, RE_DATE, RE_ID, RE_NICK, re_no
  FROM (SELECT re_ip IP, RE_CONTENT, RE_DATE, RE_ID, RE_NICK, re_no
          FROM reply where b_no=#{b_no}))
</select>

<!-- 리플 삭제를 위한 아이디 체크 -->
<select id="checkReply" parameterType="replyVO" resultType="replyVO">
	select * from reply where re_no=#{re_no}
</select>

<!-- 리플삭제 -->
<delete id="deleteReply" parameterType="replyVO">
DELETE FROM reply where re_no=#{re_no}
</delete>

<!-- 리플 등록 -->
<insert id="replInsert" parameterType="replyVO">
	insert into reply values ( mom_reply_no.nextval, sysdate, #{re_content}, #{re_id}, #{b_no}, #{re_nick}, #{re_ip})
</insert>

<!-- 게시판 등록 -->
<insert id="boardInsert" parameterType="memberVO"> <!-- insert,delete,update는 리턴타입 필요없음 -->
	Insert into normal_board 
	(b_no, b_cate, b_title, b_content, b_date, b_ip, b_nick, u_id
	<if test="b_photo1name !=null">
		, b_photo1name
	</if>
	<if test="b_photo2name !=null">
		, b_photo2name
	</if>
	<if test="b_photo3name !=null">
		, b_photo3name
	</if>
	)
	VALUES(mom_board_no.nextval, #{b_cate}, #{b_title}, #{b_content}, sysdate, #{b_ip}, #{b_nick}, #{u_id}
	<if test="b_photo1name !=null">
		, #{b_photo1name}
	</if>
	<if test="b_photo2name !=null">
		, #{b_photo2name}
	</if>
	<if test="b_photo3name !=null">
		, #{b_photo3name}
	</if>
	)
</insert>
<!-- userId 같은 이름들은 parameterClass의 클래스 필드 명 -->
 
</mapper>